{{ block "review-landing" . }}
{{ if .IsReviewMode }}
<div class="course-selection-view">
    <div class="header-section">
        <h1>Review a Course</h1>
        <p>Select a course from the list below to write your review</p>
    </div>
    
    <div class="available-courses">
        <div class="course-search-container">
            <input type="text" id="course-selection-search" placeholder="Search courses to review..." class="course-search-input">
            <div class="course-search-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </div>
        </div>
        {{ if .UsePagination }}
        <div id="courses-container">
            <div class="loading-spinner">Loading courses...</div>
        </div>
        <div id="debug-info" style="padding: 20px; background: #f0f0f0; margin: 20px 0; font-size: 12px;">
            <p>Debug: UsePagination = {{ .UsePagination }}</p>
            <p>If courses don't load, check console for errors.</p>
        </div>
        {{ else }}
        <div class="courses-grid">
            {{ range $index, $course := .AvailableCourses }}
            <div class="course-card clickable-card" 
                 hx-get="/review-course/{{ $course.JSONIndex }}" 
                 hx-target="#main-content">
                <div class="course-card-header">
                    <h3>{{ $course.Name }}</h3>
                    <span class="course-address">{{ $course.Address }}</span>
                </div>
            </div>
            {{ end }}
        </div>
        {{ end }}
    </div>
</div>

<!-- Review Form (Initially Hidden) -->
<div class="course-review-form" id="review-form" >
    <div class="course-detail">
        <div class="header-section">
            <div class="title-and-line">
                <h1 id="selected-course-name">Course Name</h1>
                <div class="line-section">
                    <span id="selected-course-description">Course description</span>
                </div>
            </div>
            <div class="tier-box">
                <select id="overall-rating" class="rating-value-select">
                    <option value="">-</option>
                    <option value="S">S</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="F">F</option>
                </select>
                <div class="tier-label">TIER</div>
            </div>
        </div>
        
        <div class="course-content">
            <div class="course-table">
                <table>
                    <tr>
                        <th style="background-color: #000000;">Category</th>
                        <th style="background-color: #000000;">Rating</th>
                    </tr>
                    <tr>
                        <td>Price</td>
                        <td class="editable-cell">
                            <select id="price" class="rating-select">
                                <option value="">Select</option>
                                <option value="$">$</option>
                                <option value="$$">$$</option>
                                <option value="$$$">$$$</option>
                                <option value="$$$$">$$$$</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Handicap Difficulty</td>
                        <td class="editable-cell">
                            <input type="number" id="handicap-difficulty" min="0" max="20" placeholder="0-20" class="number-input">
                            <span class="unit-text">handicap</span>
                        </td>
                    </tr>
                    <tr>
                        <td>Hazard Difficulty</td>
                        <td class="editable-cell">
                            <input type="number" id="hazard-difficulty" min="0" max="5" placeholder="0-5" class="number-input">
                            <span class="unit-text">Sleeve(s)</span>
                        </td>
                    </tr>
                    <tr>
                        <td>Merch</td>
                        <td class="editable-cell">
                            <select id="merch" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Condition</td>
                        <td class="editable-cell">
                            <select id="condition" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Enjoyment Rating</td>
                        <td class="editable-cell">
                            <select id="enjoyment-rating" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Vibe</td>
                        <td class="editable-cell">
                            <select id="vibe" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Range</td>
                        <td class="editable-cell">
                            <select id="range" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Amenities</td>
                        <td class="editable-cell">
                            <select id="amenities" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Turn Dog</td>
                        <td class="editable-cell">
                            <select id="glizzies" class="rating-select">
                                <option value="">Select</option>
                                <option value="S">S</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="F">F</option>
                            </select>
                        </td>
                    </tr>
                </table>
                
                <div class="scoring-section">
                    <h3>Scores (Optional)</h3>
                    <div id="scores-container">
                        <!-- Scores will be added dynamically -->
                    </div>
                    <button type="button" class="add-score-btn" onclick="addScore()">+ Add Score</button>
                </div>
            </div>
            
            <div class="course-info">
                <h2>Course Details</h2>
                <div class="detail-item">
                    <label for="course-address">Address:</label>
                    <input type="text" id="course-address" class="address-input" readonly>
                </div>
                
                <h2>What's the read on this course?</h2>
                <div class="review-section">
                    <textarea id="course-review" placeholder="Write a detailed review of the course including highlights, challenges, and overall experience" class="review-textarea"></textarea>
                </div>
                
                <br style="clear: both; margin-bottom: 20px;"/>
                
                <div class="hole-by-hole-section">
                    <h2>Hole by Hole</h2>
                    <div id="holes-container">
                        <!-- Holes will be added dynamically -->
                    </div>
                    <button type="button" class="add-hole-btn" onclick="addHole()">+ Add Hole</button>
                </div>
                
                <div class="save-section">
                    <div class="ownership-notice">
                        <small>📝 This review will be associated with your account and you'll be able to edit it later.</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="back-to-selection-btn" onclick="showCourseSelection()">← Back to Course Selection</button>
                        <button type="button" class="save-course-btn" onclick="saveCourseReview()">Save Review</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{ else }}
<!-- Keep existing edit mode structure for editing existing reviews -->
<div class="course-detail">
    <div class="header-section">
        <div class="title-and-line">
            <h1 contenteditable="true" id="course-name" data-placeholder="Enter Course Name">{{ if .IsEdit }}{{ .Course.Name }}{{ else }}New Golf Course{{ end }}</h1>
            <div class="line-section">
                <span class="line-description" contenteditable="true" id="course-description" data-placeholder="Enter course description">{{ if .IsEdit }}{{ .Course.Description }}{{ else }}Click to add description{{ end }}</span>
            </div>
        </div>
        <div class="tier-box">
            <select id="overall-rating" class="rating-value-select">
                <option value="">-</option>
                <option value="S" {{ if and .IsEdit (eq .Course.OverallRating "S") }}selected{{ end }}>S</option>
                <option value="A" {{ if and .IsEdit (eq .Course.OverallRating "A") }}selected{{ end }}>A</option>
                <option value="B" {{ if and .IsEdit (eq .Course.OverallRating "B") }}selected{{ end }}>B</option>
                <option value="C" {{ if and .IsEdit (eq .Course.OverallRating "C") }}selected{{ end }}>C</option>
                <option value="D" {{ if and .IsEdit (eq .Course.OverallRating "D") }}selected{{ end }}>D</option>
                <option value="F" {{ if and .IsEdit (eq .Course.OverallRating "F") }}selected{{ end }}>F</option>
            </select>
            <div class="tier-label">TIER</div>
        </div>
    </div>
    
    <div class="course-content">
        <div class="course-table">
            <table>
                <tr>
                    <th style="background-color: #000000;">Category</th>
                    <th style="background-color: #000000;">Rating</th>
                </tr>
                <tr>
                    <td>Price</td>
                    <td class="editable-cell">
                        <select id="price" class="rating-select">
                            <option value="">Select</option>
                            <option value="$" {{ if and .IsEdit (eq .Course.Ranks.Price "$") }}selected{{ end }}>$</option>
                            <option value="$$" {{ if and .IsEdit (eq .Course.Ranks.Price "$$") }}selected{{ end }}>$$</option>
                            <option value="$$$" {{ if and .IsEdit (eq .Course.Ranks.Price "$$$") }}selected{{ end }}>$$$</option>
                            <option value="$$$$" {{ if and .IsEdit (eq .Course.Ranks.Price "$$$$") }}selected{{ end }}>$$$$</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Handicap Difficulty</td>
                    <td class="editable-cell">
                        <input type="number" id="handicap-difficulty" min="0" max="20" placeholder="0-20" class="number-input" value="{{ if .IsEdit }}{{ .Course.Ranks.HandicapDifficulty }}{{ end }}">
                        <span class="unit-text">handicap</span>
                    </td>
                </tr>
                <tr>
                    <td>Hazard Difficulty</td>
                    <td class="editable-cell">
                        <input type="number" id="hazard-difficulty" min="0" max="5" placeholder="0-5" class="number-input" value="{{ if .IsEdit }}{{ .Course.Ranks.HazardDifficulty }}{{ end }}">
                        <span class="unit-text">Sleeve(s)</span>
                    </td>
                </tr>
                <tr>
                    <td>Merch</td>
                    <td class="editable-cell">
                        <select id="merch" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.Merch "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.Merch "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.Merch "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.Merch "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.Merch "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.Merch "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Condition</td>
                    <td class="editable-cell">
                        <select id="condition" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.Condition "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.Condition "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.Condition "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.Condition "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.Condition "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.Condition "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Enjoyment Rating</td>
                    <td class="editable-cell">
                        <select id="enjoyment-rating" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.EnjoymentRating "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.EnjoymentRating "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.EnjoymentRating "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.EnjoymentRating "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.EnjoymentRating "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.EnjoymentRating "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Vibe</td>
                    <td class="editable-cell">
                        <select id="vibe" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.Vibe "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.Vibe "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.Vibe "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.Vibe "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.Vibe "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.Vibe "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Range</td>
                    <td class="editable-cell">
                        <select id="range" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.Range "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.Range "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.Range "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.Range "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.Range "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.Range "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Amenities</td>
                    <td class="editable-cell">
                        <select id="amenities" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.Amenities "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.Amenities "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.Amenities "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.Amenities "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.Amenities "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.Amenities "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Turn Dog</td>
                    <td class="editable-cell">
                        <select id="glizzies" class="rating-select">
                            <option value="">Select</option>
                            <option value="S" {{ if and .IsEdit (eq .Course.Ranks.Glizzies "S") }}selected{{ end }}>S</option>
                            <option value="A" {{ if and .IsEdit (eq .Course.Ranks.Glizzies "A") }}selected{{ end }}>A</option>
                            <option value="B" {{ if and .IsEdit (eq .Course.Ranks.Glizzies "B") }}selected{{ end }}>B</option>
                            <option value="C" {{ if and .IsEdit (eq .Course.Ranks.Glizzies "C") }}selected{{ end }}>C</option>
                            <option value="D" {{ if and .IsEdit (eq .Course.Ranks.Glizzies "D") }}selected{{ end }}>D</option>
                            <option value="F" {{ if and .IsEdit (eq .Course.Ranks.Glizzies "F") }}selected{{ end }}>F</option>
                        </select>
                    </td>
                </tr>
            </table>
            
            <div class="scoring-section">
                <h3>Scores (Optional)</h3>
                <div id="scores-container">
                    <!-- Scores will be added dynamically -->
                </div>
                <button type="button" class="add-score-btn" onclick="addScore()">+ Add Score</button>
            </div>
        </div>
        
        <div class="course-info">
            <h2>Course Details</h2>
            <div class="detail-item">
                <label for="course-address">Address:</label>
                <input type="text" id="course-address" class="address-input" 
                       placeholder="Enter the full address of the course"
                       value="{{ if .IsEdit }}{{ .Course.Address }}{{ end }}">
            </div>
            
            <h2>Whats the read on this course?</h2>
            <div class="review-section">
                <textarea id="course-review" placeholder="Write a detailed review of the course including highlights, challenges, and overall experience" class="review-textarea">{{ if .IsEdit }}{{ .Course.Review }}{{ end }}</textarea>
            </div>
            
            <br style="clear: both; margin-bottom: 20px;"/>
            
            <div class="hole-by-hole-section">
                <h2>Hole by Hole</h2>
                <div id="holes-container">
                    <!-- Holes will be added dynamically -->
                </div>
                <button type="button" class="add-hole-btn" onclick="addHole()">+ Add Hole</button>
            </div>
            
            <div class="save-section">
                {{ if not .IsEdit }}
                <div class="ownership-notice">
                    <small>📝 This course will be associated with your account and you'll be able to edit it later.</small>
                </div>
                {{ end }}
                <button type="button" class="save-course-btn" onclick="saveCourse()">{{ if .IsEdit }}Update Course{{ else }}Save Course{{ end }}</button>
            </div>
        </div>
    </div>
</div>
{{ end }}

<style>
    /* Course Selection View - Match design system */
    .course-selection-view {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        background-color: #FFFCE7;
    }

    .course-selection-view .header-section {
        display: block !important;
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 0px;
        max-width: none !important;
        gap: 0 !important;
        align-items: initial !important;
        justify-content: initial !important;
    }

    .course-selection-view h1 {
        color: #204606;
        font-size: 2.5em;
        margin: 0 0 15px 0;
        font-weight: 600;
        line-height: 1.2;
    }

    .course-selection-view p {
        color: #204606;
        font-size: 1.1em;
        margin: 0 0 25px 0;
        opacity: 0.8;
        line-height: 1.4;
    }

    /* Course Search Container */
    .course-search-container {
        position: relative;
        margin-bottom: 20px;
    }

    .course-search-input {
        width: 100%;
        padding: 12px 45px 12px 15px;
        border: 2px solid rgba(32, 70, 6, 0.3);
        border-radius: 8px;
        font-size: 1em;
        background-color: #FFFCE7;
        color: #204606;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }

    .course-search-input:focus {
        outline: none;
        border-color: #204606;
        box-shadow: 0 0 0 2px rgba(32, 70, 6, 0.1);
    }

    .course-search-input::placeholder {
        color: rgba(32, 70, 6, 0.6);
    }

    .course-search-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(32, 70, 6, 0.6);
        pointer-events: none;
    }

    .courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .course-card {
        background-color: white;
        border: 2px solid rgba(32, 70, 6, 0.1);
        border-radius: 8px;
        padding: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .course-card:hover {
        border-color: rgba(32, 70, 6, 0.3);
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }

    .clickable-card {
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .clickable-card:hover {
        border-color: #204606;
        box-shadow: 0 6px 20px rgba(32, 70, 6, 0.15);
        transform: translateY(-3px);
    }

    .clickable-card:active {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(32, 70, 6, 0.2);
    }

    .course-card-header {
        margin-bottom: 8px;
        padding-bottom: 8px;
    }

    .course-card-header h3 {
        margin: 0 0 4px 0;
        color: #204606;
        font-size: 1.1em;
        font-weight: 600;
    }

    .course-address {
        color: #666;
        font-size: 0.9em;
        margin: 0;
    }

    .course-card-description {
        margin: 8px 0 0 0;
    }

    .course-card-description p {
        margin: 0;
        color: #204606;
        line-height: 1.3;
        font-size: 0.9em;
    }



    .no-courses-available {
        text-align: center;
        padding: 60px 20px;
        background-color: rgba(181, 216, 68, 0.05);
        border-radius: 12px;
        border: 2px dashed rgba(32, 70, 6, 0.2);
        margin: 20px 0;
    }

    .no-courses-available h2 {
        color: #204606;
        font-size: 1.8em;
        margin: 0 0 15px 0;
        font-weight: 600;
    }

    .no-courses-available p {
        color: #666;
        font-size: 1.1em;
        margin: 0 0 25px 0;
        line-height: 1.4;
    }

    .return-home-btn {
        background-color: #204606;
        color: #FFFCE7;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 500;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .return-home-btn:hover {
        background-color: #2d6509;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    /* Review Form Actions */
    .form-actions {
        display: flex;
        gap: 15px;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
    }

    .back-to-selection-btn {
        background-color: transparent;
        color: #204606;
        border: 2px solid #204606;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .back-to-selection-btn:hover {
        background-color: #204606;
        color: #FFFCE7;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Base Layout */
    .course-detail {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .header-section {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        margin-bottom: 40px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .title-and-line {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        margin-right: 20px;
    }

    .course-content {
        display: flex;
        gap: 40px;
    }

    .course-table {
        flex: 0 0 400px;
        border-radius: 8px;
        overflow: hidden;
    }

    .course-info {
        flex: 1;
        padding: 20px;
        background-color: #B5D844;
        border-radius: 8px;
        border: 1px solid #E5E7EB;
    }

    /* Typography */
    .course-detail h1 {
        text-align: center;
        color: #204606;
        font-size: 3.5em;
        font-weight: bold;
        margin: 0;
        border: 2px dashed transparent;
        padding: 10px;
        border-radius: 8px;
        min-height: 1.2em;
        outline: none;
        cursor: text;
    }

    .course-detail h1:hover, .course-detail h1:focus {
        border-color: #204606;
        background-color: rgba(32, 70, 6, 0.05);
    }

    .course-detail h1:empty:before, .line-description:empty:before {
        content: attr(data-placeholder);
        color: #999;
        font-style: italic;
    }

    .course-info h2 {
        color: #204606;
        margin-top: 0;
        margin-bottom: 16px;
        font-size: 1.5em;
    }

    .course-info h3 {
        color: #204606;
        margin-top: 20px;
        margin-bottom: 16px;
        font-size: 1.3em;
    }

    /* Form Elements - Unified Styling */
    input, textarea, select {
        padding: 10px 12px;
        border: 2px dashed #204606;
        border-radius: 6px;
        font-size: 14px;
        color: #204606;
        background-color: rgba(255, 255, 255, 0.8);
        outline: none;
        transition: all 0.2s ease;
        font-family: inherit;
    }

    input:focus, textarea:focus, select:focus {
        border-style: solid;
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 0 0 2px rgba(32, 70, 6, 0.1);
    }

    input::placeholder, textarea::placeholder {
        color: #999;
        font-style: italic;
    }

    input[readonly] {
        background-color: rgba(32, 70, 6, 0.1);
        border-style: solid;
        color: #666;
        cursor: not-allowed;
    }

    /* Specific Form Overrides */
    .rating-value-select {
        font-size: 3em;
        font-weight: bold;
        background: transparent;
        border: none;
        color: white;
        text-align: center;
        width: 80px;
    }

    .rating-select, .number-input {
        background: transparent;
        border: 1px solid transparent;
        width: 80px;
        padding: 4px 8px;
    }

    .rating-select:hover, .rating-select:focus,
    .number-input:hover, .number-input:focus {
        border-color: #204606;
        background-color: rgba(255, 255, 255, 0.9);
    }

    .address-input {
        width: 100%;
        padding: 12px;
    }

    .review-textarea {
        width: 100%;
        min-height: 120px;
        padding: 15px;
        line-height: 1.6;
        resize: vertical;
        box-sizing: border-box;
    }

    /* Tier Box */
    .tier-box {
        background-color: #204606;
        color: white;
        padding: 15px 30px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        flex-shrink: 0;
    }

    .tier-label {
        font-size: 0.8em;
        font-weight: 500;
        letter-spacing: 1px;
    }

    /* Table */
    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    th {
        font-weight: 600;
        color: white;
    }

    th:first-child, td:first-child {
        background-color: #204606;
        width: 40%;
        color: white;
    }

    th:last-child, td:last-child {
        background-color: #BABEBC;
    }

    tr:last-child td {
        border-bottom: none;
    }

    tr:hover td:first-child {
        background-color: #000000;
    }

    tr:hover td:last-child {
        background-color: #B5D844;
    }

    /* Dynamic Content Containers */
    .hole-entry, .score-entry {
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 15px;
        border: 1px solid rgba(32, 70, 6, 0.2);
    }

    .hole-entry {
        padding: 20px;
        margin-bottom: 20px;
    }

    .hole-entry h3 {
        color: #204606;
        margin: 0 0 15px 0;
        font-size: 1.3em;
        font-weight: 600;
    }

    /* Grid Layouts */
    .hole-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
    }

    .hole-inputs textarea {
        grid-column: 1 / -1;
        min-height: 80px;
        line-height: 1.5;
        box-sizing: border-box;
    }

    .score-inputs {
        display: grid;
        grid-template-columns: 80px 180px auto;
        gap: 15px;
        align-items: center;
    }

    /* Buttons */
    .add-hole-btn, .add-score-btn, .save-course-btn, .remove-btn {
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s ease;
    }

    .add-hole-btn, .add-score-btn {
        background-color: #204606;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        margin-top: 10px;
    }

    .add-hole-btn:hover, .add-score-btn:hover {
        background-color: #153505;
    }

    .save-course-btn {
        background-color: #28a745;
        color: white;
        font-size: 18px;
        padding: 15px 30px;
        margin-top: 30px;
        width: 100%;
    }

    .save-course-btn:hover {
        background-color: #218838;
    }

    .remove-btn {
        background-color: #dc3545;
        color: white;
        padding: 8px 12px;
        font-size: 12px;
    }

    .remove-btn:hover {
        background-color: #c82333;
    }

    /* Utility Classes */
    .line-description {
        color: #204606;
        font-style: italic;
        border: 2px dashed transparent;
        padding: 8px;
        border-radius: 4px;
        outline: none;
        cursor: text;
        display: inline-block;
        min-width: 200px;
        min-height: 1.2em;
    }

    .line-description:hover, .line-description:focus {
        border-color: #204606;
        background-color: rgba(32, 70, 6, 0.05);
    }

    .scoring-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #204606;
    }

    .save-section {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 2px solid #204606;
    }

    .ownership-notice {
        margin-bottom: 15px;
        padding: 10px 15px;
        background-color: rgba(181, 216, 68, 0.2);
        border: 1px solid rgba(32, 70, 6, 0.3);
        border-radius: 6px;
        text-align: center;
    }

    .ownership-notice small {
        color: #204606;
        font-size: 14px;
    }

    .hole-by-hole-section {
        margin-top: 30px;
    }

    #holes-container, #scores-container {
        margin-bottom: 20px;
    }

    .unit-text {
        margin-left: 8px;
        font-size: 14px;
        color: #666;
    }

    /* Rating Colors */
    .rating-S { background-color: #73FF73 !important; }
    .rating-A { background-color: #B7FF73 !important; }
    .rating-B { background-color: #FFFF73 !important; }
    .rating-C { background-color: #FFDA74 !important; }
    .rating-D { background-color: #FFB774 !important; }
    .rating-F { background-color: #FF7474 !important; }

    /* Mobile */
    @media (max-width: 768px) {
        .hole-inputs, .score-inputs {
            grid-template-columns: 1fr;
        }
        
        .hole-inputs textarea {
            grid-column: 1;
        }
    }

    /* Review page pagination styles */
    .pagination {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 20px 0;
        border-top: 1px solid rgba(32, 70, 6, 0.1);
        margin-top: 20px;
    }

    .page-btn {
        padding: 8px 16px;
        border: 1px solid rgba(32, 70, 6, 0.2);
        background: white;
        color: #204606;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.2s ease;
    }

    .page-btn:hover {
        background: rgba(32, 70, 6, 0.1);
        border-color: #204606;
    }

    .page-btn.active {
        background: #204606;
        color: white;
        font-weight: 600;
    }

    .page-info {
        color: rgba(32, 70, 6, 0.7);
        font-size: 0.85em;
        margin-left: 12px;
    }

    .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px;
        color: rgba(32, 70, 6, 0.7);
        font-size: 1em;
    }

    .loading-spinner:before {
        content: '';
        width: 24px;
        height: 24px;
        border: 3px solid rgba(32, 70, 6, 0.2);
        border-top: 3px solid #204606;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 12px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .error-message {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px;
        color: #e53e3e;
        text-align: center;
        font-size: 1em;
    }

    .no-courses-message {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px;
        color: rgba(32, 70, 6, 0.7);
        text-align: center;
        font-size: 1em;
    }
</style>

<script>
    /* eslint-disable */
    // @ts-nocheck
    
    console.log('🎯 Create course page loading...');
    
    // Global variables for counters
    var holeCount = 0;
    var scoreCount = 0;
    
    // Check if we're editing
    var isEdit = {{ if .IsEdit }}true{{ else }}false{{ end }};
    var courseId = {{ if .IsEdit }}{{ .Course.ID }}{{ else }}null{{ end }};
    var usePagination = {{ if .UsePagination }}true{{ else }}false{{ end }};

    console.log('📋 Form initialized:', { isEdit, courseId, holeCount, scoreCount, usePagination });

    // Review course pagination system
    if (usePagination) {
        window.reviewPagination = {
            currentPage: 1,
            totalPages: 1,
            totalItems: 0,
            itemsPerPage: 20,
            currentSearch: '',
            loading: false
        };

        // Load courses with pagination
        function loadReviewCoursePage(page = 1, search = null) {
            if (window.reviewPagination.loading) return;
            
            window.reviewPagination.currentPage = page;
            if (search !== null) window.reviewPagination.currentSearch = search;
            
            const container = document.getElementById('courses-container');
            if (!container) return;
            
            window.reviewPagination.loading = true;
            container.innerHTML = '<div class="loading-spinner">Loading courses...</div>';
            
            const params = new URLSearchParams({
                page: window.reviewPagination.currentPage,
                limit: window.reviewPagination.itemsPerPage,
                search: window.reviewPagination.currentSearch
            });
            
            console.log(`🚀 Loading review courses page ${page}, search: "${window.reviewPagination.currentSearch}"`);
            
            fetch(`/api/courses/review?${params}`)
                .then(response => {
                    console.log('📡 API Response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('📦 API Data received:', data);
                    
                    if (!data.courses || !data.pagination) {
                        throw new Error('Invalid API response structure');
                    }
                    
                    window.reviewPagination.totalPages = data.pagination.totalPages;
                    window.reviewPagination.totalItems = data.pagination.totalItems;
                    
                    renderReviewCoursePage(data);
                    
                    console.log(`✅ Loaded review page ${data.pagination.currentPage}/${data.pagination.totalPages} (${data.courses.length} courses)`);
                })
                .catch(error => {
                    console.error('❌ Error loading review courses:', error);
                    container.innerHTML = `<div class="error-message">Failed to load courses: ${error.message}</div>`;
                })
                .finally(() => {
                    window.reviewPagination.loading = false;
                });
        }

        // Render review courses page
        function renderReviewCoursePage(data) {
            const container = document.getElementById('courses-container');
            if (!container) return;
            
            const coursesHTML = generateReviewCoursesHTML(data.courses);
            const paginationHTML = generateReviewPaginationHTML(data.pagination);
            
            container.innerHTML = `<div class="courses-grid">${coursesHTML}</div>${paginationHTML}`;
            
            // Re-initialize HTMX for new content
            if (typeof htmx !== 'undefined') {
                htmx.process(container);
            }
        }

        // Generate HTML for review courses
        function generateReviewCoursesHTML(courses) {
            if (courses.length === 0) {
                return '<div class="no-courses-message"><p>No courses found</p></div>';
            }
            
            return courses.map(course => `
                <div class="course-card clickable-card" 
                     hx-get="/review-course/${course.jsonIndex}" 
                     hx-target="#main-content">
                    <div class="course-card-header">
                        <h3>${course.Name || course.name}</h3>
                        <span class="course-address">${course.Address || course.address || ''}</span>
                    </div>
                </div>
            `).join('');
        }

        // Generate pagination HTML
        function generateReviewPaginationHTML(paginationData) {
            if (paginationData.totalPages <= 1) return '';
            
            const current = paginationData.currentPage;
            const total = paginationData.totalPages;
            
            let pagination = '<div class="pagination">';
            
            if (paginationData.hasPrev) {
                pagination += `<button onclick="loadReviewCoursePage(${current - 1})" class="page-btn">← Prev</button>`;
            }
            
            const startPage = Math.max(1, current - 1);
            const endPage = Math.min(total, current + 1);
            
            for (let i = startPage; i <= endPage; i++) {
                const active = i === current ? ' active' : '';
                pagination += `<button onclick="loadReviewCoursePage(${i})" class="page-btn${active}">${i}</button>`;
            }
            
            if (paginationData.hasNext) {
                pagination += `<button onclick="loadReviewCoursePage(${current + 1})" class="page-btn">Next →</button>`;
            }
            
            pagination += `<span class="page-info">Page ${current} of ${total} (${paginationData.totalItems} courses)</span></div>`;
            
            return pagination;
        }

        // Initialize search with debounce
        function initializeReviewSearch() {
            const searchInput = document.getElementById('course-selection-search');
            if (searchInput) {
                let searchTimeout;
                
                searchInput.addEventListener('input', function(e) {
                    clearTimeout(searchTimeout);
                    const searchTerm = e.target.value.trim();
                    
                    searchTimeout = setTimeout(() => {
                        console.log('🔍 Review search:', searchTerm);
                        loadReviewCoursePage(1, searchTerm);
                    }, 300);
                });
            }
        }

        // Initialize immediately since we're already in the page
        function initializeReviewPage() {
            console.log('🎯 Initializing review page pagination');
            loadReviewCoursePage(1);
            initializeReviewSearch();
        }
        
        // Initialize on page load or immediately if DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeReviewPage);
        } else {
            initializeReviewPage();
        }
    }

    // Function to add a new hole
    function addHole(holeData = null) {
        console.log('⛳ Adding hole:', { holeData, currentCount: holeCount });
        
        try {
            const container = document.getElementById('holes-container');
            if (!container) {
                console.error('❌ Holes container not found');
                return;
            }
            
            const holeDiv = document.createElement('div');
            holeDiv.className = 'hole-entry';
            
            const holeNumber = holeData ? holeData.Number : (holeCount + 1);
            const par = holeData ? holeData.Par : '';
            const yardage = holeData ? holeData.Yardage : '';
            const description = holeData ? holeData.Description : '';
            
            holeDiv.innerHTML = `
                <h3>Hole ${holeNumber}</h3>
                <div class="hole-inputs">
                    <input type="number" name="holes[${holeCount}].number" value="${holeNumber}" readonly>
                    <input type="number" name="holes[${holeCount}].par" placeholder="Par (3-6)" min="3" max="6" value="${par}">
                    <input type="number" name="holes[${holeCount}].yardage" placeholder="Yardage" min="0" value="${yardage}">
                    <textarea name="holes[${holeCount}].description" placeholder="Describe this hole (optional)">${description}</textarea>
                    <button type="button" onclick="removeHole(this)" class="remove-btn">Remove Hole</button>
                </div>
            `;
            container.appendChild(holeDiv);
            holeCount++;
            
            console.log('✅ Hole added successfully. Total holes:', holeCount);
            
        } catch (error) {
            console.error('💥 Error adding hole:', error);
        }
    }

    // Function to add a new score
    function addScore(scoreData = null) {
        console.log('🎯 Adding score:', { scoreData, currentCount: scoreCount });
        
        try {
            const container = document.getElementById('scores-container');
            if (!container) {
                console.error('❌ Scores container not found');
                return;
            }
            
            const scoreDiv = document.createElement('div');
            scoreDiv.className = 'score-entry';
            
            const score = scoreData ? scoreData.Score : '';
            const handicap = scoreData ? scoreData.Handicap : '';
            
            scoreDiv.innerHTML = `
                <div class="score-inputs">
                    <input type="number" name="scores[${scoreCount}].score" placeholder="Total Score" min="0" value="${score}">
                    <input type="number" name="scores[${scoreCount}].handicap" placeholder="Handicap" step="0.1" min="0" max="54" value="${handicap}">
                    <button type="button" onclick="removeScore(this)" class="remove-btn">Remove</button>
                </div>
            `;
            container.appendChild(scoreDiv);
            scoreCount++;
            
            console.log('✅ Score added successfully. Total scores:', scoreCount);
            
        } catch (error) {
            console.error('💥 Error adding score:', error);
        }
    }

    // Add remove functions
    function removeHole(button) {
        const holeEntry = button.closest('.hole-entry');
        console.log('🗑️ Removing hole');
        holeEntry.remove();
    }

    function removeScore(button) {
        const scoreEntry = button.closest('.score-entry');
        console.log('🗑️ Removing score');
        scoreEntry.remove();
    }

    // Initialize data loading
    console.log('🚀 Starting data initialization...');
    
    if (isEdit) {
        console.log('✏️ Edit mode: Loading existing course data');
        
        // Add existing holes if they exist
        {{ if and .IsEdit .Course.Holes }}
            console.log('📊 Loading {{ len .Course.Holes }} existing holes');
            {{ range .Course.Holes }}
                addHole({
                    Number: {{ .Number }},
                    Par: {{ .Par }},
                    Yardage: {{ .Yardage }},
                    Description: {{ .Description | printf "%q" }}
                });
            {{ end }}
            console.log('✅ All holes loaded');
        {{ else }}
            console.log('ℹ️ No existing holes to load');
        {{ end }}
        
        // Add existing scores if they exist
        {{ if and .IsEdit .Course.Scores }}
            console.log('📊 Loading {{ len .Course.Scores }} existing scores');
            {{ range .Course.Scores }}
                addScore({
                    Score: {{ .Score }},
                    Handicap: {{ .Handicap }}
                });
            {{ end }}
            console.log('✅ All scores loaded');
        {{ else }}
            console.log('ℹ️ No existing scores to load');
        {{ end }}
    } else {
        console.log('🆕 Create mode: Starting with empty form');
    }

    console.log('✅ Data initialization complete');

    // Function to save the course
    function saveCourse() {
        console.log('💾 Starting course save process...');
        
        try {
            // Get form values
            const formData = new FormData();
            
            // Basic course information
            let name = document.getElementById('course-name').innerText.trim();
            let description = document.getElementById('course-description').innerText.trim();
            const overallRating = document.getElementById('overall-rating').value;
            const address = document.getElementById('course-address').value;
            const review = document.getElementById('course-review').value;

            console.log('📝 Raw form data:', { 
                name, 
                description, 
                overallRating, 
                address, 
                reviewLength: review.length 
            });

            // Handle placeholder text
            if (name === 'New Golf Course' || name === 'Enter Course Name') {
                console.warn('⚠️ Placeholder name detected, clearing');
                name = '';
            }
            if (description === 'Click to add description' || description === 'Enter course description') {
                console.warn('⚠️ Placeholder description detected, clearing');
                description = '';
            }

            // Validate required fields
            const validation = {
                name: !!name,
                description: !!description,
                rating: !!overallRating
            };
            
            console.log('🔍 Validation check:', validation);
            
            if (!name || !description || !overallRating) {
                console.error('❌ Validation failed:', validation);
                alert('Please fill in course name, description, and overall rating');
                return;
            }
            
            console.log('✅ Validation passed');

            // Add basic information to form data
            formData.append('name', name);
            formData.append('description', description);
            formData.append('overallRating', overallRating);
            formData.append('address', address);
            formData.append('review', review);

            // Add rankings
            const rankings = [
                'price', 'handicapDifficulty', 'hazardDifficulty', 'merch', 
                'condition', 'enjoymentRating', 'vibe', 'range', 'amenities', 'glizzies'
            ];
            
            rankings.forEach(ranking => {
                const value = document.getElementById(ranking.replace(/([A-Z])/g, '-$1').toLowerCase()).value;
                formData.append(ranking, value);
                console.log(`📊 ${ranking}:`, value);
            });

            // Add holes
            const holeElements = document.querySelectorAll('.hole-entry');
            console.log(`⛳ Processing ${holeElements.length} holes`);
            
            holeElements.forEach((holeElement, index) => {
                const inputs = holeElement.querySelectorAll('input, textarea');
                const holeData = {};
                
                inputs.forEach(input => {
                    const fieldName = input.name.split('.').pop();
                    holeData[fieldName] = input.value;
                    formData.append(`holes[${index}].${fieldName}`, input.value);
                });
                
                console.log(`⛳ Hole ${index + 1}:`, holeData);
            });

            // Add scores
            const scoreElements = document.querySelectorAll('.score-entry');
            console.log(`🎯 Processing ${scoreElements.length} scores`);
            
            scoreElements.forEach((scoreElement, index) => {
                const inputs = scoreElement.querySelectorAll('input');
                const scoreData = {};
                
                inputs.forEach(input => {
                    const fieldName = input.name.split('.').pop();
                    scoreData[fieldName] = input.value;
                    formData.append(`scores[${index}].${fieldName}`, input.value);
                });
                
                console.log(`🎯 Score ${index + 1}:`, scoreData);
            });

            // Determine the endpoint
            const endpoint = isEdit ? `/edit-course/${courseId}` : '/create-course';
            const method = 'POST';
            
            console.log('🎯 Submitting to:', { endpoint, method, isEdit });
            
            // Submit via HTMX
            htmx.ajax('POST', endpoint, {
                values: formData,
                target: '#main-content'
            });
            
            console.log('📤 Form submitted via HTMX');
            
        } catch (error) {
            console.error('💥 Critical error in saveCourse:', error);
            alert('An error occurred while saving the course: ' + error.message);
        }
    }
    
    // Add HTMX event logging
    document.addEventListener('htmx:beforeRequest', function(e) {
        console.log('🚀 HTMX Request starting:', e.detail.requestConfig.verb, e.detail.requestConfig.path);
    });
    
    document.addEventListener('htmx:afterRequest', function(e) {
        if (e.detail.xhr.status >= 400) {
            console.error('❌ HTMX Error:', e.detail.xhr.status, e.detail.xhr.response);
        } else {
            console.log('✅ HTMX Success:', e.detail.xhr.status);
        }
    });
    
    console.log('🎉 Create course JavaScript fully loaded');

    // ========================================
    // COURSE SELECTION FUNCTIONS (for review mode)
    // ========================================
    
    // Use window properties to avoid redeclaration errors
    window.selectedCourseIndex = window.selectedCourseIndex || null;
    window.selectedCourseData = window.selectedCourseData || null;

    // Course search functionality for selection page
    function initializeCourseSelectionSearch() {
        console.log('🔍 Initializing course selection search...');
        const searchInput = document.getElementById('course-selection-search');
        console.log('🔍 Search input found:', !!searchInput);
        
        if (searchInput) {
            searchInput.addEventListener('input', function(e) {
                console.log('🔍 Search input changed:', e.target.value);
                filterCourseSelection();
            });
            console.log('✅ Search event listener added');
        } else {
            console.log('❌ Search input not found');
        }
    }

    function filterCourseSelection() {
        const searchInput = document.getElementById('course-selection-search');
        const searchTerm = searchInput?.value.toLowerCase().trim() || '';
        const courseCards = document.querySelectorAll('.course-card');
        let visibleCount = 0;

        console.log(`🔍 Filtering courses - Search term: "${searchTerm}", Total cards: ${courseCards.length}`);

        courseCards.forEach((card, index) => {
            const courseName = card.querySelector('h3')?.textContent.toLowerCase() || '';
            const courseAddress = card.querySelector('.course-address')?.textContent.toLowerCase() || '';
            const courseDescription = card.querySelector('.course-card-description p')?.textContent.toLowerCase() || '';
            
            const matchesSearch = searchTerm === '' || 
                courseName.includes(searchTerm) || 
                courseAddress.includes(searchTerm) || 
                courseDescription.includes(searchTerm);

            console.log(`Card ${index}: "${courseName}" - Matches: ${matchesSearch}`);

            if (matchesSearch) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        console.log(`🔍 Course selection search complete: "${searchTerm}", visible: ${visibleCount}/${courseCards.length}`);
    }

    function selectCourse(courseId, name, description, address) {
        window.selectedCourseIndex = courseId;
        window.selectedCourseData = { name, description, address };
        
        console.log('🎯 Selected course:', name, 'ID:', courseId);
        
        // Update the review form with course data
        document.getElementById('selected-course-name').textContent = name;
        document.getElementById('selected-course-description').textContent = description;
        document.getElementById('course-address').value = address;
        
        // Show review form and hide selection
        document.querySelector('.course-selection-view').style.display = 'none';
        document.getElementById('review-form').style.display = 'block';
        
        // Scroll to top
        window.scrollTo(0, 0);
    }

    function showCourseSelection() {
        document.querySelector('.course-selection-view').style.display = 'block';
        document.getElementById('review-form').style.display = 'none';
        window.scrollTo(0, 0);
    }

    function saveCourseReview() {
        if (window.selectedCourseIndex === null) {
            alert('No course selected');
            return;
        }

        try {
            const formData = new FormData();
            
            // Add selected course ID
            formData.append('selectedCourseId', window.selectedCourseIndex);
            
            // Add all the review data
            formData.append('overall-rating', document.getElementById('overall-rating').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('handicap-difficulty', document.getElementById('handicap-difficulty').value);
            formData.append('hazard-difficulty', document.getElementById('hazard-difficulty').value);
            formData.append('merch', document.getElementById('merch').value);
            formData.append('condition', document.getElementById('condition').value);
            formData.append('enjoyment-rating', document.getElementById('enjoyment-rating').value);
            formData.append('vibe', document.getElementById('vibe').value);
            formData.append('range', document.getElementById('range').value);
            formData.append('amenities', document.getElementById('amenities').value);
            formData.append('glizzies', document.getElementById('glizzies').value);
            formData.append('course-review', document.getElementById('course-review').value);
            
            // Add scores and holes
            const scoreElements = document.querySelectorAll('#scores-container .score-entry');
            scoreElements.forEach((scoreElement, index) => {
                const inputs = scoreElement.querySelectorAll('input');
                inputs.forEach(input => {
                    if (input.value) {
                        formData.append(input.name, input.value);
                    }
                });
            });

            const holeElements = document.querySelectorAll('#holes-container .hole-entry');
            holeElements.forEach((holeElement, index) => {
                const inputs = holeElement.querySelectorAll('input, textarea');
                inputs.forEach(input => {
                    if (input.value) {
                        formData.append(input.name, input.value);
                    }
                });
            });
            
            console.log('📤 Submitting course review for:', window.selectedCourseData.name);
            
            // Submit via HTMX
            htmx.ajax('POST', '/create-course', {
                values: formData,
                target: '#main-content'
            });
            
        } catch (error) {
            console.error('💥 Error saving course review:', error);
            alert('An error occurred while saving the review: ' + error.message);
        }
    }

    // ========================================
    // EDIT MODE FUNCTIONS 
    // ========================================
    
    function saveEditedCourse() {
        try {
            const formData = new FormData();
            
            // Add course data that can be edited
            formData.append('name', document.getElementById('course-name').textContent);
            formData.append('description', document.getElementById('course-description').textContent);
            formData.append('overallRating', document.getElementById('overall-rating').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('handicapDifficulty', document.getElementById('handicap-difficulty').value);
            formData.append('hazardDifficulty', document.getElementById('hazard-difficulty').value);
            formData.append('merch', document.getElementById('merch').value);
            formData.append('condition', document.getElementById('condition').value);
            formData.append('enjoymentRating', document.getElementById('enjoyment-rating').value);
            formData.append('vibe', document.getElementById('vibe').value);
            formData.append('range', document.getElementById('range').value);
            formData.append('amenities', document.getElementById('amenities').value);
            formData.append('glizzies', document.getElementById('glizzies').value);
            formData.append('review', document.getElementById('course-review').value);
            formData.append('address', document.getElementById('course-address').value);
            
            // Add scores and holes
            const scoreElements = document.querySelectorAll('#scores-container .score-entry');
            scoreElements.forEach((scoreElement, index) => {
                const inputs = scoreElement.querySelectorAll('input');
                inputs.forEach(input => {
                    if (input.value) {
                        formData.append(input.name, input.value);
                    }
                });
            });

            const holeElements = document.querySelectorAll('#holes-container .hole-entry');
            holeElements.forEach((holeElement, index) => {
                const inputs = holeElement.querySelectorAll('input, textarea');
                inputs.forEach(input => {
                    if (input.value) {
                        formData.append(input.name, input.value);
                    }
                });
            });
            
            console.log('📤 Updating course review');
            
            // Submit via HTMX
            htmx.ajax('POST', `/edit-course/${courseId}`, {
                values: formData,
                target: '#main-content'
            });
            
        } catch (error) {
            console.error('💥 Error updating course review:', error);
            alert('An error occurred while updating the review: ' + error.message);
        }
    }

    // ========================================
    // INITIALIZATION
    // ========================================
    
    // Initialize search functionality - try multiple times to ensure it works
    function initializeSearch() {
        console.log('🚀 Attempting to initialize course selection search...');
        initializeCourseSelectionSearch();
        
        // Fallback: try again after a short delay if search input wasn't found
        setTimeout(() => {
            const searchInput = document.getElementById('course-selection-search');
            if (searchInput && !searchInput.hasEventListener) {
                console.log('🔄 Retrying search initialization...');
                initializeCourseSelectionSearch();
                searchInput.hasEventListener = true;
            }
        }, 500);
    }
    
    // Initialize on DOM ready
    document.addEventListener('DOMContentLoaded', initializeSearch);
    
    // Also initialize immediately if DOM is already loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeSearch);
    } else {
        initializeSearch();
    }
    
    // Initialize after HTMX content updates (for dynamic loading)
    document.addEventListener('htmx:afterSwap', function() {
        console.log('🔄 HTMX content swapped, reinitializing search...');
        setTimeout(initializeSearch, 100);
    });



</script>
{{ end }}

